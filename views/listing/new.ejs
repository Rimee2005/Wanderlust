<% layout("/layouts/boilerplate") %>

<div class="row mt-3">
    <div class="col-8 offset-2">
        <h1>Create a New Listing</h1>

        <form
          action="/listings"
          method="POST" 
          novalidate
          class="needs-validation"
          enctype="multipart/form-data"
        >
            <!-- Title -->
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input 
                    type="text" 
                    name="listing[title]"
                    placeholder="Add a Catchy Title"  
                    class="form-control"
                    required
                />
                <div class="invalid-feedback">Enter Title</div>
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea name="listing[description]" 
                          class="form-control"
                          required></textarea>  
                <div class="invalid-feedback">Enter a short Description</div>
            </div> 

            <!-- Image -->
            <div class="mb-3">
                <label for="image" class="form-label">Upload Image</label>
                <input  
                    name="listing[image]" 
                    type="file"
                    class="form-control"
                />
            </div>

            <!-- Price & Country -->
            <div class="row">
                <div class="mb-3 col-4">
                    <label for="price" class="form-label">Price</label>
                    <input type="text" 
                        name="listing[price]" 
                        placeholder="1200" 
                        class="form-control" 
                        required>
                    <div class="invalid-feedback">Price should be valid</div>
                </div>

                <div class="mb-3 col-md-8">
                    <label for="country" class="form-label">Country</label>
                    <input type="text"
                        name="listing[country]"  
                        placeholder="India"
                        class="form-control" 
                        required>
                    <div class="invalid-feedback">Country name should be valid</div>
                </div>
            </div>

            <!-- Location -->
            <div class="mb-3">
                <label for="location" class="form-label">Location</label>
                <input type="text" 
                    name="listing[location]" 
                    placeholder="Jaipur, Ajmer" 
                    class="form-control"
                    required>
                <div class="invalid-feedback">Location should be valid</div>
            </div>

            <button type="submit" class="btn btn-dark add-btn mt-3">Add</button>
        </form>

        <br>
        <a href="/listings">Back to Listings</a>
        <br><br>
    </div>
</div>

<!-- CSS for Responsive Category Dropdown -->
<style>
    .form-control {
        display: block;
    }

    /* Show category select on larger screens and custom dropdown on smaller screens */
    @media (max-width: 768px) {
        .d-none {
            display: none;
        }

        .dropdown-menu {
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
            z-index: 1;
            padding: 10px;
        }
    }
</style>

<script>
    // Handling category selection for the custom dropdown (on smaller screens)
    const dropdownItems = document.querySelectorAll('.dropdown-item');
    dropdownItems.forEach(item => {
        item.addEventListener('click', (e) => {
            const selectedCategory = e.target.dataset.category;
            const categorySelect = document.querySelector('select[name="listing[category]"]');
            categorySelect.value = selectedCategory;
        });
    });
</script>
